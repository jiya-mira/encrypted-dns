name: ðŸ”„ Update Rolling Release

# Trigger: Push to master branch affecting 'signed/' folder.
on:
  push:
    branches:
      - master
    paths:
      - 'signed/**'

permissions:
  contents: write

# Concurrency: Cancel any in-progress jobs to ensure only the latest state is published.
concurrency:
  group: release-rolling
  cancel-in-progress: true

jobs:
  update-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          # We need full history to move the tag properly
          fetch-depth: 0

      - name: Update 'latest' Tag
        # This step forces the 'latest' tag to move to the current commit.
        # It creates a "moving target" that always points to the newest code.
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git tag -f latest
          git push -f origin latest

      - name: Publish Rolling Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: latest
          name: ðŸš€ Latest Auto-Update
          draft: false
          prerelease: false
          make_latest: true
          # This ensures old assets are replaced by new ones
          files: signed/*.mobileconfig
          body: |
            ## ðŸŸ¢ Latest Signed Profiles
            
            **Last Updated:** ${{ github.event.head_commit.timestamp }}
            
            This release is automatically updated to reflect the latest changes in the `signed/` directory.
            
            ### ðŸ“¥ Installation Guide
            
            1. **Download**: Click on the `.mobileconfig` file you need in the **Assets** section below.
            2. **Install**:
               - **iOS**: Settings -> Profile Downloaded -> Install.
               - **macOS**: System Settings -> Privacy & Security -> Profiles.